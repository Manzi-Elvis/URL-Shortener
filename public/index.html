<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Simple URL Shortener</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 32px; max-width: 900px; margin: auto; }
    input, button { font-size: 1rem; padding: 0.6rem; }
    .row { display:flex; gap:8px; margin-bottom:12px; }
    .card { border: 1px solid #eee; padding: 12px; border-radius:8px; }
    pre { background:#f6f8fa; padding:8px; border-radius:6px; overflow:auto }
    a.small { font-size:0.9rem; color:#0366d6 }
  </style>
</head>
<body>
  <h1>Simple URL Shortener</h1>
  <p>Create a short link and track clicks.</p>

  <div class="card">
    <div class="row">
      <input id="url" type="url" placeholder="Enter your URL" style="flex:1" />
      <input id="custom" placeholder="custom code (optional)" />
      <button id="shorten">Shorten</button>
    </div>
    <div class="row">
      <label>Expire at (optional):</label>
      <input id="expire" type="datetime-local" />
    </div>
    <div id="result" style="margin-top:12px"></div>
  </div>

  <h3>Your recent links</h3>
  <div id="list"></div>

  <p style="margin-top:2rem">
    <a href="dashboard.html" class="small">Open Stats Dashboard</a>
  </p>

<script>
async function shorten() {
  const url = document.getElementById("url").value.trim();
  const custom = document.getElementById("custom").value.trim() || undefined;
  const expireVal = document.getElementById("expire").value;
  const body = { url };
  if (custom) body.customCode = custom;
  if (expireVal) body.expireAt = new Date(expireVal).toISOString();

  try {
    const res = await fetch("/api/shorten", {
      method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data?.error || "Failed");
    document.getElementById("result").innerHTML = `
      <div>Short URL: <strong><a href="${data.shortUrl}" target="_blank">${data.shortUrl}</a></strong></div>
      <div>Original: <small>${data.originalUrl}</small></div>
      <div>Code: <code>${data.code}</code></div>
      <div>Created: ${data.createdAt}</div>
    `;
    fetchList();
  } catch (err) {
    document.getElementById("result").innerText = "Error: " + err.message;
  }
}

async function fetchList() {
  const res = await fetch("/api/list");
  const rows = await res.json();
  const el = document.getElementById("list");
  if (!rows.length) { el.innerHTML = "<div>No links yet</div>"; return; }
  el.innerHTML = rows.map(r => `
    <div class="card" style="margin-bottom:8px">
      <div><a href="${r.shortUrl}" target="_blank">${r.shortUrl}</a> â€” <small>${r.clicks} clicks</small></div>
      <div style="font-size:0.9rem;color:#333">${r.originalUrl}</div>
      <div style="margin-top:6px"><a href="/dashboard.html?code=${r.code}" class="small">View stats</a></div>
    </div>
  `).join("");
}

document.getElementById("shorten").addEventListener("click", shorten);
window.addEventListener("load", fetchList);
</script>
</body>
</html>
